<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nhà Thông Minh - Arduino IoT Dashboard</title>
    <meta name="description" content="Hệ thống điều khiển và giám sát nhà thông minh với Arduino - Quản lý đèn, quạt, nhiệt độ, khí gas và vườn rau" />
    <meta name="author" content="Smart Home System" />

    <meta property="og:title" content="Nhà Thông Minh - Arduino IoT Dashboard" />
    <meta property="og:description" content="Hệ thống điều khiển và giám sát nhà thông minh với Arduino" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <style>
      /* Chatbox draggable styles */
      #chatbase-bubble-button,
      #chatbase-bubble-window {
        cursor: move !important;
        user-select: none !important;
      }
      
      #chatbase-bubble-window {
        transition: none !important;
      }
      
      #chatbase-bubble-window.dragging {
        transition: none !important;
      }
    </style>
    
    <script>
      window.embeddedChatbotConfig = {
        chatbotId: "5yuoGvi_QBUVJTPqUY0rf",
        domain: "www.chatbase.co"
      }
    </script>
    <script
      src="https://www.chatbase.co/embed.min.js"
      chatbotId="5yuoGvi_QBUVJTPqUY0rf"
      domain="www.chatbase.co"
      defer>
    </script>
    
    <script>
      // Wait for chatbox to load
      window.addEventListener('load', function() {
        setTimeout(function() {
          const chatButton = document.getElementById('chatbase-bubble-button');
          const chatWindow = document.getElementById('chatbase-bubble-window');
          
          if (!chatButton || !chatWindow) return;
          
          let isDragging = false;
          let currentX;
          let currentY;
          let initialX;
          let initialY;
          let xOffset = 0;
          let yOffset = 0;
          
          // Make chatbox draggable
          function dragStart(e) {
            const target = e.target.closest('#chatbase-bubble-window') || e.target.closest('#chatbase-bubble-button');
            if (!target) return;
            
            if (e.type === "touchstart") {
              initialX = e.touches[0].clientX - xOffset;
              initialY = e.touches[0].clientY - yOffset;
            } else {
              initialX = e.clientX - xOffset;
              initialY = e.clientY - yOffset;
            }
            
            isDragging = true;
            target.classList.add('dragging');
          }
          
          function dragEnd(e) {
            isDragging = false;
            const target = e.target.closest('#chatbase-bubble-window') || e.target.closest('#chatbase-bubble-button');
            if (target) {
              target.classList.remove('dragging');
            }
          }
          
          function drag(e) {
            if (!isDragging) return;
            
            e.preventDefault();
            
            const target = document.getElementById('chatbase-bubble-window') || document.getElementById('chatbase-bubble-button');
            if (!target) return;
            
            if (e.type === "touchmove") {
              currentX = e.touches[0].clientX - initialX;
              currentY = e.touches[0].clientY - initialY;
            } else {
              currentX = e.clientX - initialX;
              currentY = e.clientY - initialY;
            }
            
            xOffset = currentX;
            yOffset = currentY;
            
            setTranslate(currentX, currentY, target);
          }
          
          function setTranslate(xPos, yPos, el) {
            el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
          }
          
          // Add event listeners for dragging
          chatWindow.addEventListener('mousedown', dragStart);
          chatWindow.addEventListener('mouseup', dragEnd);
          chatWindow.addEventListener('mousemove', drag);
          
          chatButton.addEventListener('mousedown', dragStart);
          chatButton.addEventListener('mouseup', dragEnd);
          chatButton.addEventListener('mousemove', drag);
          
          // Touch events for mobile
          chatWindow.addEventListener('touchstart', dragStart);
          chatWindow.addEventListener('touchend', dragEnd);
          chatWindow.addEventListener('touchmove', drag);
          
          chatButton.addEventListener('touchstart', dragStart);
          chatButton.addEventListener('touchend', dragEnd);
          chatButton.addEventListener('touchmove', drag);
          
          // Auto position at bottom when toggled
          const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              if (mutation.attributeName === 'style') {
                const isVisible = chatWindow.style.display !== 'none' && 
                                chatWindow.style.opacity !== '0' &&
                                chatWindow.style.visibility !== 'hidden';
                
                if (isVisible && !isDragging) {
                  // Reset position to bottom right when opened
                  xOffset = 0;
                  yOffset = 0;
                  chatWindow.style.transform = 'translate3d(0, 0, 0)';
                }
              }
            });
          });
          
          observer.observe(chatWindow, { attributes: true });
          
        }, 2000);
      });
    </script>
  </body>
</html>
